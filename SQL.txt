alter table CREDIT_CARD_ALERT add COM_USE VARCHAR2(10);
alter table CREDIT_CARD_MESSAGE add TRADE_ID VARCHAR2(32);
alter table CREDIT_CARD_MESSAGE add OPERATOR_TLR VARCHAR2(30);
alter table CREDIT_CARD_MESSAGE add APPROVE_TLR VARCHAR2(30);

--短信状态
DELETE from DATA_DIC where DATA_TYPE_NO = '1012';
insert into DATA_DIC (ID, DATA_TYPE_NO, DATA_NO, DATA_TYPE_NAME, DATA_NO_LEN, DATA_NAME, LIMIT_FLAG, HIGH_LIMIT, LOW_LIMIT, EFFECT_DATE, EXPIRE_DATE, TIMESTAMPS, MISCFLGS, APPROVE_STATUS, APPROVE_RESULT, REC_STATUS, REP_STATUS, IS_SUB_SUCCESS, CRT_TM, LST_UPD_TM, LST_UPD_TLR, APPTYPE, BR_NO, YWDATE, ORGCODE, RECORD_UPD_TLR, RECORD_UPD_TM, ST) values (1063, 1012, '0', '发送状态', 1, '0-待处理', null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, '1');
insert into DATA_DIC (ID, DATA_TYPE_NO, DATA_NO, DATA_TYPE_NAME, DATA_NO_LEN, DATA_NAME, LIMIT_FLAG, HIGH_LIMIT, LOW_LIMIT, EFFECT_DATE, EXPIRE_DATE, TIMESTAMPS, MISCFLGS, APPROVE_STATUS, APPROVE_RESULT, REC_STATUS, REP_STATUS, IS_SUB_SUCCESS, CRT_TM, LST_UPD_TM, LST_UPD_TLR, APPTYPE, BR_NO, YWDATE, ORGCODE, RECORD_UPD_TLR, RECORD_UPD_TM, ST) values (1064, 1012, '1', '发送状态', 1, '1-短信文件已生成', null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, '1');
insert into DATA_DIC (ID, DATA_TYPE_NO, DATA_NO, DATA_TYPE_NAME, DATA_NO_LEN, DATA_NAME, LIMIT_FLAG, HIGH_LIMIT, LOW_LIMIT, EFFECT_DATE, EXPIRE_DATE, TIMESTAMPS, MISCFLGS, APPROVE_STATUS, APPROVE_RESULT, REC_STATUS, REP_STATUS, IS_SUB_SUCCESS, CRT_TM, LST_UPD_TM, LST_UPD_TLR, APPTYPE, BR_NO, YWDATE, ORGCODE, RECORD_UPD_TLR, RECORD_UPD_TM, ST) values (1065, 1012, '2', '发送状态', 1, '2-短信文件已上传', null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, '1');
insert into DATA_DIC (ID, DATA_TYPE_NO, DATA_NO, DATA_TYPE_NAME, DATA_NO_LEN, DATA_NAME, LIMIT_FLAG, HIGH_LIMIT, LOW_LIMIT, EFFECT_DATE, EXPIRE_DATE, TIMESTAMPS, MISCFLGS, APPROVE_STATUS, APPROVE_RESULT, REC_STATUS, REP_STATUS, IS_SUB_SUCCESS, CRT_TM, LST_UPD_TM, LST_UPD_TLR, APPTYPE, BR_NO, YWDATE, ORGCODE, RECORD_UPD_TLR, RECORD_UPD_TM, ST) values (1066, 1012, '3', '发送状态', 1, '3-短信文件上传失败', null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, '1');
insert into DATA_DIC (ID, DATA_TYPE_NO, DATA_NO, DATA_TYPE_NAME, DATA_NO_LEN, DATA_NAME, LIMIT_FLAG, HIGH_LIMIT, LOW_LIMIT, EFFECT_DATE, EXPIRE_DATE, TIMESTAMPS, MISCFLGS, APPROVE_STATUS, APPROVE_RESULT, REC_STATUS, REP_STATUS, IS_SUB_SUCCESS, CRT_TM, LST_UPD_TM, LST_UPD_TLR, APPTYPE, BR_NO, YWDATE, ORGCODE, RECORD_UPD_TLR, RECORD_UPD_TM, ST) values (1105, 1012, '8', '发送状态', 1, '8-待复核', null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, '1');
insert into DATA_DIC (ID, DATA_TYPE_NO, DATA_NO, DATA_TYPE_NAME, DATA_NO_LEN, DATA_NAME, LIMIT_FLAG, HIGH_LIMIT, LOW_LIMIT, EFFECT_DATE, EXPIRE_DATE, TIMESTAMPS, MISCFLGS, APPROVE_STATUS, APPROVE_RESULT, REC_STATUS, REP_STATUS, IS_SUB_SUCCESS, CRT_TM, LST_UPD_TM, LST_UPD_TLR, APPTYPE, BR_NO, YWDATE, ORGCODE, RECORD_UPD_TLR, RECORD_UPD_TM, ST) values (1106, 1012, '9', '发送状态', 1, '9-已拒绝', null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, '1');

--降额 1018
insert into DATA_DIC (ID, DATA_TYPE_NO, DATA_NO, DATA_TYPE_NAME, DATA_NO_LEN, DATA_NAME, LIMIT_FLAG, HIGH_LIMIT, LOW_LIMIT, EFFECT_DATE, EXPIRE_DATE, TIMESTAMPS, MISCFLGS, APPROVE_STATUS, APPROVE_RESULT, REC_STATUS, REP_STATUS, IS_SUB_SUCCESS, CRT_TM, LST_UPD_TM, LST_UPD_TLR, APPTYPE, BR_NO, YWDATE, ORGCODE, RECORD_UPD_TLR, RECORD_UPD_TM, ST) values (1146, 1018, '0', '降额', 2, '0-否', null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, '1');
insert into DATA_DIC (ID, DATA_TYPE_NO, DATA_NO, DATA_TYPE_NAME, DATA_NO_LEN, DATA_NAME, LIMIT_FLAG, HIGH_LIMIT, LOW_LIMIT, EFFECT_DATE, EXPIRE_DATE, TIMESTAMPS, MISCFLGS, APPROVE_STATUS, APPROVE_RESULT, REC_STATUS, REP_STATUS, IS_SUB_SUCCESS, CRT_TM, LST_UPD_TM, LST_UPD_TLR, APPTYPE, BR_NO, YWDATE, ORGCODE, RECORD_UPD_TLR, RECORD_UPD_TM, ST) values (1147, 1018, '1', '降额', 3, '1-是(5%)', null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, '1');
insert into DATA_DIC (ID, DATA_TYPE_NO, DATA_NO, DATA_TYPE_NAME, DATA_NO_LEN, DATA_NAME, LIMIT_FLAG, HIGH_LIMIT, LOW_LIMIT, EFFECT_DATE, EXPIRE_DATE, TIMESTAMPS, MISCFLGS, APPROVE_STATUS, APPROVE_RESULT, REC_STATUS, REP_STATUS, IS_SUB_SUCCESS, CRT_TM, LST_UPD_TM, LST_UPD_TLR, APPTYPE, BR_NO, YWDATE, ORGCODE, RECORD_UPD_TLR, RECORD_UPD_TM, ST) values (1148, 1018, '2', '降额', 4, '2-是(10%)', null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, '1');

create or REPLACE view VI_CREDIT_CARD_BLOCK1 AS
SELECT SYS_GUID() as ID,substr(a.ALARM_DATE,0,6) as ALARM_MONTH,a.ALARM_DATE,substr(a.ALARM_NO,9,19) ACCOUNTNO,substr(a.INVESTIGATE_RESULT,2,1) as INVESTIGATE_RESULT,
(case when a.reduce in('1','2') then 'Y' else 'N' end) as reduce
FROM CREDIT_CARD_ALERT a 

insert into SYS_PARAMS (PARAMGROUP_ID, PARAM_ID, PARAM_VAL, PARAM_NAME, MEMO, ST, IS_LOCK, IS_DEL, CRT_DT, LAST_UPD_TMS, LAST_UPD_OPER) values ('ALERT', 'BLOCK', '4', '大于等于0的整数', '冻结判断前N月', null, null, null, '20201120', '20201120195229', null);

insert into FUNCTION_INFO (FUNCID, FUNCNAME, PAGEPATH, LOCATION, ISDIRECTORY, LASTDIRECTORY, SHOWSEQ, FUNC_CLASS, FUNC_TYPE, WORKFLOW_FLAG, UP_FUNC_CODE, FUNC_DESC, STATUS, EFFECT_DATE, EXPIRE_DATE, TIMESTAMPS, MISCFLGS, MISC, ICON_CLS) values ('6023', '短信审核', '/fpages/creditcard/ftl/CreditCardMsgApproveInfo.ftl', 2, 0, '60', 23, null, '1', null, null, null, '1', null, null, null, null, null, 'icon-ok');

insert into FUNCTION_INFO (FUNCID, FUNCNAME, PAGEPATH, LOCATION, ISDIRECTORY, LASTDIRECTORY, SHOWSEQ, FUNC_CLASS, FUNC_TYPE, WORKFLOW_FLAG, UP_FUNC_CODE, FUNC_DESC, STATUS, EFFECT_DATE, EXPIRE_DATE, TIMESTAMPS, MISCFLGS, MISC, ICON_CLS) values ('6023', '短信审核', '/fpages/creditcard/ftl/CreditCardMsgApproveInfo.ftl', 2, 0, '60', 23, null, '1', null, null, null, '1', null, null, null, null, null, 'icon-ok');


--20201216
create or replace view vi_homepage_todo_credit_msg as
select a.ALARM_DATE,a.OPERATOR_TLR,a.RISK_LEVEL,'01' AS TYPE,a.ALARM_NO,
(select count(1) from AML_SSHLDYP d where d.natural_date>=to_date(substr(a.OPEN_ALERT_TIME,1,8),'yyyymmdd') and d.natural_date<=sysdate and d.is_holiday='0') AS NUM
from vi_homepage_todo_credit_01 a  where a.INVESTIGATE_RESULT='0_01' and a.MESSAGE_RESULT in ('02','04')
and to_date(substr(a.MSG_TIME,1,8), 'yyyymmdd')<=(
select c.natural_date from (
select rownum as rn,b.natural_date from ( select b.natural_date
   from aml_sshldyp b
  where b.natural_date <= sysDate
    and b.is_holiday = '0'
  order by b.natural_date desc)b )c where c.rn=4)


create or replace view vi_homepage_todo_credit as					
select SYS_GUID() as id,x.* from VI_HOMEPAGE_TODO_CREDIT_MSG x					
union					
select SYS_GUID() as id,x.* from VI_HOMEPAGE_TODO_CREDIT_OUT x	


update SYS_PARAMS  set PARAM_NAME='客户落入套现中高风险名单或经调查后客户交易无法排除套现风险'  where PARAMGROUP_ID='MSGINFO' and PARAM_ID='01';
update SYS_PARAMS  set PARAM_NAME='客户交易无法排除商业用途'  where PARAMGROUP_ID='MSGINFO' and PARAM_ID='06';
update SYS_PARAMS  set PARAM_NAME='客户落入套现关注类名单提醒规范用卡'  where PARAMGROUP_ID='MSGINFO' and PARAM_ID='99';
update SYS_PARAMS  set PARAM_NAME='客户落入套现关注类/低风险名单提醒规范用卡，并注意后续来电'  where PARAMGROUP_ID='MSGINFO' and PARAM_ID='07';
update SYS_PARAMS  set PARAM_NAME='异常交易监控团队外呼调查无法联系客户'  where PARAMGROUP_ID='MSGINFO' and PARAM_ID='08';
update SYS_PARAMS  set PARAM_NAME='客户争议结果，需客户提供相关凭证'  where PARAMGROUP_ID='MSGINFO' and PARAM_ID='09';				

